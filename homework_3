# Task 3: ACL

Ваша задача - завершить настройку директории общего доступа. 
Директория и всё её содержимое должно принадлежать группе bakerstreet, при этом файлы должны обновляться для чтения и записи для владельца и группы (bakerstreet). У других пользователей не должно быть никаких разрешений. 
Вам также необходимо предоставить доступы на чтение и запись для группы scotlandyard, за исключением Jones, который может только читать документы.
Убедитесь, что ваша настройка применима к существующим и будущим файлам. После установки всех разрешений в директории проверьте от каждого пользователя все его возможные доступы.

Используйте команды: touch, mkdir, chgrp, chmod, getfacl, setfacl и другие. 
Создайте общую директорию /share/cases.
Создайте группу bakerstreet с пользователями holmes, watson.
Создайте группу scotlandyard с пользователями lestrade, gregson, jones.
Задайте всем пользователям безопасные пароли.

Сначала создадим общую директорию
[student@localhost /]$ sudo mkdir share
[student@localhost /]$ sudo mkdir share/cases

Дадим доступ для директории (и вложенной тоже) на чтение/запись/просмотр для владельца и группы
[student@localhost /]$ sudo chmod 770 -R share

Создадим файлы
[root@localhost cases]# touch murders.txt
[root@localhost cases]# touch moriarty.txt

Создадим группы
[student@localhost /]$ sudo groupadd backerstreet
[student@localhost /]$ sudo groupadd scotlandyard

Создадим пользователей с присвоением группы
[student@localhost /]$ sudo useradd -g 4002 holmes
[student@localhost /]$ sudo useradd -g 4002 watson
[student@localhost /]$ sudo useradd -g 4003 lestrade
[student@localhost /]$ sudo useradd -g 4003 gregson
[student@localhost /]$ sudo useradd -g 4003 jones

Изменим владельца и группу для директории (и вложенной директории, а также файлов)
[student@localhost /]$ sudo chown -R holmes:backerstreet share

С помощью getfacl установим права на чтение/запись/просмотр также для группы scotlandyard
[holmes@localhost /]$ setfacl -m g:scotlandyard:rwx /share

Поменяем права доступа на чтение/запись файлов для группы scotlandyard
[holmes@localhost cases]$ setfacl -m g:scotlandyard:rw moriarty.txt
[holmes@localhost cases]$ setfacl -m g:scotlandyard:rw murders.txt

Зададим права на чтение/просмотр для пользователя jones
[holmes@localhost share]$ setfacl -m u:jones:rx /share
[holmes@localhost share]$ setfacl -m u:jones:rx /share/cases

И зададим права только на чтение для jones
[holmes@localhost cases]$ setfacl -m u:jones:r /share/cases/murders.txt
[holmes@localhost cases]$ setfacl -m u:jones:r /share/cases/moriarty.txt

Уберем права для остальных пользователей на фалйы внутри директории cases
[root@localhost cases]# chmod 660 murders.txt
[root@localhost cases]# chmod 660 moriarty.txt

Далее устанавливаем постоянное наследование прав для директорий
[holmes@localhost cases]$ setfacl -m d:g:backerstreet:rwx /share
[holmes@localhost cases]$ setfacl -m d:g:backerstreet:rwx /share/cases
[holmes@localhost cases]$ setfacl -m d:g:scotlandyard:rwx /share
[holmes@localhost cases]$ setfacl -m d:g:scotlandyard:rwx /share/cases
[holmes@localhost cases]$ setfacl -m d:u:jones:rwx /share/
[holmes@localhost cases]$ setfacl -m d:u:jones:r /share/cases

Теперь все файлы в директории будут наследовать права выше
[jones@localhost cases]$ getfacl .
# file: .
# owner: holmes
# group: backerstreet
user::rwx
user:jones:r-x
group::rwx
group:scotlandyard:rwx
mask::rwx
other::---
default:user::rwx
default:user:jones:r-x
default:group::rwx
default:group:backerstreet:rwx
default:group:scotlandyard:rwx
default:mask::rwx

В итоге при попытке создать файл или изменить/удалить пользователь jones будет получать сообщение об ошибке
[jones@localhost cases]$ ls -l
total 12
-rw-rw----+ 1 holmes backerstreet 20 Dec 15 01:30 holmes.txt
-rw-rw----+ 1 holmes backerstreet 15 Dec 15 01:28 moriarty.txt
-rw-rw----+ 1 holmes backerstreet 11 Dec 15 01:28 murders.txt
-rw-rw----+ 1 holmes backerstreet  0 Dec 15 01:31 test.txt
[jones@localhost cases]$ touch testtest
touch: cannot touch ‘testtest’: Permission denied
[jones@localhost cases]$ rm test.txt
rm: remove write-protected regular empty file ‘test.txt’? y
rm: cannot remove ‘test.txt’: Permission denied

Как видно ниже, права для групп и пользователя jones наследуются при создании нового файла
[holmes@localhost cases]$ touch test.txt
[holmes@localhost cases]$ getfacl test.txtt
getfacl: test.txtt: No such file or directory
[holmes@localhost cases]$ getfacl test.txt
# file: test.txt
# owner: holmes
# group: backerstreet
user::rw-
user:jones:r-x                  #effective:r--
group::rwx                      #effective:rw-
group:backerstreet:rwx          #effective:rw-
group:scotlandyard:rwx          #effective:rw-
mask::rw-
other::---
